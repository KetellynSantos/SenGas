<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Histórico - Sen Gás</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="icon" href="../assets/imgs/logo.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <aside class="sidebar">
        <div class="sidebar-top">
            <img class="logo-img" src="../assets/imgs/logoLetraBranca.png.png" alt="Sen Gás logo">
        </div>

        <nav class="nav-dashboard">
            <ul>
                <li><a href="./dashboard.html">Dashboard </a></li>
                <li><a href="./setores.html">Setores</a></li>
                <li><a class="active" href="./historicoDashboard.html">Histórico</a></li>
                <li><a href="https://brenogoal.atlassian.net/jira/software/c/projects/GS/list?jql=project+%3D+%22GS%22+ORDER+BY+created+DESC&atlOrigin=eyJpIjoiZmJkMWM4NDNmM2NjNDk0NGEwODYyN2NhOTViNjNhYTEiLCJwIjoiaiJ9"
                        target="_blank">Suporte</a></li>

            </ul>
        </nav>
        <button class="button-sair" onclick="window.location.href='../index.html'">
            <i class="fa-solid fa-right-from-bracket" style="color: #fcfcfd;"></i> Sair </button>
        <p class="reserved">© 2025 SenGás All Rights Reserved</p>
    </aside>

    <main class="main-content">
        <header class="topbar">
            <div class="topbar-left">

                <h1>Histórico</h1>
            </div>
            <div class="user">
                <span> Empresa Xpto </span>
                <img src="../assets/imgs/iconeUsuario.svg" alt="Usuária" class="avatar">
            </div>
        </header>

        <div class="legenda">
            <span><span class="cor no-limite"></span>No limite</span>
            <span><span class="cor acima"></span>Acima do limite</span>
            <span><span class="cor abaixo"></span>Abaixo do limite</span>
        </div>

        <table class="tabela">
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Setor</th>
                    <th>Valor</th>
                    <th>Limite</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="dadosTabela">
            </tbody>
        </table>
    </main>
</body>

</html>

<script>
    async function carregarHistorico() {
        try {
            const resposta = await fetch(`/historico/listar`);  // Rota do backend

            if (!resposta.ok) {
                console.error(`Erro HTTP: ${resposta.status}`);
            }

            const historicoDados = await resposta.json();
            const tbody = document.getElementById("dadosTabela");

            tbody.innerHTML = ""; // limpa a tabela

            historicoDados.forEach(dado => {

                const dataFormatada = new Date(dado.data).toLocaleString("pt-BR", {
                    day: "2-digit",
                    month: "2-digit",
                    year: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",
                });

                const corStatus =
                    dado.status === "No limite" ? "orange" :
                        dado.status === "Acima do limite" ? "red" : "green";

                tbody.innerHTML += `
                    <tr>
                    <td>${dataFormatada}</td>
                    <td>${dado.setor}</td>
                    <td>${dado.valor}</td>
                    <td>${dado.limite}</td>
                    <td style="color: ${corStatus}; font-weight: bold;">
                        ${dado.status}
                    </td>
                </tr>
            `;
            });
        } catch (erro) {
            console.error("Erro ao carregar histórico:", erro);
        }
    }

    // Carrega assim que a página abrir
    window.onload = carregarHistorico;

</script>