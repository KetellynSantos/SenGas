<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/cadastro.css">
  <link rel="icon" href="../Assets/imagens/logo.png" type="image/x-icon">
  <title>Cadastro</title>
</head>

<body>

  <div class="container" id="container">
    <img src="../public/assets/imgs/sengas.png" class="loga" alt="">
    <br>
    <h1>Crie sua conta</h1>
    <br>

    <input id="iptNome" type="text" placeholder="Nome" name="username" maxlength="38" />
    <input id="iptTelefone" type="text" placeholder="Telefone" name="telefone" maxlength="38" />
    <input id="iptEmail" type="email" placeholder="Email" name="email" maxlength="95" />
    <input id="iptSenha" type="password" placeholder="Senha" name="password" maxlength="25" />
    <input id="iptConfirme" type="password" placeholder="Confirme sua Senha" name="confirm" maxlength="25" />
    <a class="termo" href="">Termos de uso</a>
    <button onclick="cadastrar()" type="submit">Criar Conta</button>
    </form>
  </div>

  <div class="container1" id="container1">
    <h2>Bem-vindo de volta!</h2>
    <p>Para se manter conectado conosco, faça login com suas informações pessoais</p>
    <button class="botao" onclick="window.location.href='./login.html'">Entrar</button>
  </div>

<div id="mensagem_erro"></div>
</body>

</html>

<script>

  // Array para armazenar empresas cadastradas para validação de código de ativação 


  function cadastrar() {
    // aguardar();
    
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = iptNome.value;
    var telefoneVar = iptTelefone.value;
    var emailVar = iptEmail.value;
    var senhaVar = iptSenha.value;
    var confirmacaoSenhaVar = iptConfirme.value;

    // Verificando se há algum campo em branco
    if (nomeVar == "" || telefoneVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {
      alert("Preencha todos os campos!")
      return;
    } 

    if (senhaVar !== confirmacaoSenhaVar) {
      alert("As senhas não coincidem!");
      return;
    }

    //recebe dados do usuario, fica mais facil de passar pro fetch
    let dadosUsuario = {
      nome: nomeVar,
      telefone: telefoneVar,
      email: emailVar,
      senha: senhaVar,
      nivelAcesso: "cliente",
      fkEmpresaUsuario: 1
    };
    // Enviando o valor da nova input
    fetch("http://localhost:3333/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(dadosUsuario),
    })

      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "1000");

          
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

</script>